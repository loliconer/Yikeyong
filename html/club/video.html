<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!--#include file="/common/head.html"-->
  <title>视频</title>
  <link rel="stylesheet" href="/css/novel.css">
  <script src="/js/vendor/vue.js"></script>
</head>
<body class="page-video">
<!--#include file="/common/nav.html"-->

<div id="app" v-cloak>
  <div class="encrypt" v-if="!openDoor">
    <input class="input" @keypress.enter="invalidate" placeholder="请输入密码">
  </div>

  <div class="overlay video-player" v-show="bShowVideo">
    <svg class="icon-close" @click="close">
      <use xlink:href="/img/icons.svg#icon-close"></use>
    </svg>
    <video ref="video" :src="current" controls>浏览器不支持HTML5播放器</video>
  </div>
  <div class="container" v-if="openDoor">
    <nav class="tags">
      <a class="btn" v-for="sec of sections" @click="scrollTo(sec.value)">{{sec.name}}</a>
      <a class="btn" @click="bShowPreviews = true">福利</a>
    </nav>
    <div class="previews" v-show="bShowPreviews">
      <div class="p-head" @click="bShowPreviews = false">关闭</div>
      <ul class="list">
        <li v-for="v of previews">
          <video @click="play($event, v)">
            <source :src=`/video/douyin/${v}`>
          </video>
        </li>
        <li></li>
      </ul>
    </div>

    <section class="section" :ref="sec.value" v-for="sec of sections">
      <h3>{{sec.name}} ({{videos[sec.value].length}})</h3>
      <ul class="list videos" :class="`list-${sec.value}`">
        <li v-for="v of videos[sec.value]">
          <a class="link" @click="view(v, sec.value)">{{v.substring(0, v.lastIndexOf('.'))}}</a>
        </li>
      </ul>
    </section>
  </div>
</div>

<script type="module">
  import videos from '/js/data/videos/index.js'

  const previews = [
    '1518083723044.mp4',
    '1518095016508.mp4',
    '1518095018915.mp4',
    '1518095019311.mp4',
    '1518095019815.mp4',
    '1518095020324.mp4',
    '1518095020748.mp4',
    '1518095022186.mp4',
    '1518095022668.mp4',
    '1518095024404.mp4',
    '1518569900457.mp4',
    '1518569900844.mp4',
    '1518569901181.mp4',
    '1518569901480.mp4',
    '1518569901854.mp4',
    '1518569902151.mp4',
    '1518569902464.mp4',
    '1518569902784.mp4',
    '1518569903138.mp4',
    '1518648296378.mp4',
    '1519350691814.mp4',
    '1519350692291.mp4',
    '1519350692826.mp4',
    '1519350695848.mp4',
    '1519350696439.mp4',
    '1519350697077.mp4',
    '1519350697437.mp4',
    '1519350697830.mp4',
    '1519350698264.mp4',
    '1519350698647.mp4',
    '1519350699414.mp4',
    '1519350699761.mp4',
    '1519350700122.mp4',
    '1519350704331.mp4',
    '1519350704799.mp4',
    '1519350705606.mp4',
    '1519350707522.mp4',
    '1519350707907.mp4',
    '1519350708640.mp4',
    '1519350709059.mp4',
    '1519350709439.mp4',
    '1519350709775.mp4',
    '1519350710096.mp4',
    '1519350710443.mp4',
    '1519350710824.mp4',
    '1519350711207.mp4',
    '1519350711574.mp4',
    '1519350711974.mp4',
    '1519350712437.mp4',
    '1519350713054.mp4',
    '1519350714220.mp4',
    '1519350714558.mp4',
    '1519350715309.mp4',
    '1519350716403.mp4',
    '1519350716741.mp4',
    '1519350717050.mp4',
    '1519350717413.mp4',
    '1519350717763.mp4',
    '1519350718147.mp4',
    '1519350718535.mp4',
    '1519350718862.mp4',
    '1519350719233.mp4',
    '1519350719917.mp4',
    '1519350720253.mp4',
    '1519350720571.mp4',
    '1519350720869.mp4',
    '1519350721178.mp4',
    '1519350721471.mp4',
    '1519350721786.mp4',
    '1519350722115.mp4',
    '1519350722486.mp4',
    '1519350722841.mp4',
    '1519350723168.mp4',
    '1519350723497.mp4',
    '1519350724121.mp4',
    '1519350724419.mp4',
    '1519350724723.mp4',
    '1519350725140.mp4',
    '1519350725628.mp4',
    '1519350726274.mp4',
    '1519350726653.mp4',
    '1519350727073.mp4',
    '1519350727398.mp4',
    '1519350727743.mp4',
    '1519350728095.mp4',
    '1519350728490.mp4',
    '1519350728819.mp4',
    '1519350729134.mp4',
    '1519350729503.mp4',
    '1519350729818.mp4',
    '1519350730140.mp4',
    '1519350730453.mp4',
    '1519350730776.mp4',
    '1519350731086.mp4',
    '1519350731411.mp4',
    '1519350731749.mp4',
    '1519350732072.mp4',
    '1519350732414.mp4',
    '1519350732739.mp4',
    '1519350733054.mp4',
    '1519350733991.mp4',
    '1519350734370.mp4',
    '1519350734686.mp4',
    '1519350735238.mp4',
    '1519350737465.mp4',
    '1519350738162.mp4',
    '1519350738542.mp4',
    '1519350739216.mp4',
    '1519350740884.mp4',
    '1519350741267.mp4',
    '1519350741612.mp4',
    '1519350741929.mp4',
    '1519350742276.mp4',
    '1519350742641.mp4',
    '1519350742962.mp4',
    '1519350743302.mp4',
    '1519350743612.mp4',
    '1519350744735.mp4',
    '1519350745065.mp4',
    '1519350745816.mp4',
    '1519350746156.mp4',
    '1519350746834.mp4',
    '1519350747157.mp4',
    '1519350747507.mp4',
    '1519350747863.mp4',
    '1519350748194.mp4',
    '1519350748557.mp4',
    '1519350748968.mp4',
    '1519350749370.mp4',
    '1519350749791.mp4',
    '1519350750186.mp4',
    '1519350750625.mp4',
    '1519350751065.mp4',
    '1519350751429.mp4',
    '1519350752160.mp4',
    '1519350752510.mp4',
    '1519350752864.mp4',
    '1519350753211.mp4',
    '1519350754338.mp4',
    '1519350754705.mp4',
    '1519350755135.mp4',
    '1519350755522.mp4',
    '1519350755895.mp4',
    '1519350756231.mp4',
    '1519350756591.mp4',
    '1519350756985.mp4',
    '1519350757696.mp4',
    '1519350758813.mp4',
    '1519350759164.mp4',
    '1519350759629.mp4',
    '1519350759987.mp4',
    '1519350760316.mp4',
    '1519350760950.mp4',
    '1519350761749.mp4',
    '1519350762250.mp4',
    '1519350762656.mp4',
    '1519350763166.mp4',
    '1519350763569.mp4',
    '1519350763923.mp4',
    '1519350764289.mp4',
    '1519350765082.mp4',
    '1519350765508.mp4',
    '1519350766277.mp4',
    '1519350766631.mp4',
    '1519350767330.mp4',
    '1519350767703.mp4',
    '1519350768057.mp4',
    '1519350768398.mp4',
    '1519350768809.mp4',
    '1519350769651.mp4',
    '1519350770084.mp4',
    '1519350770491.mp4',
    '1519350770861.mp4',
    '1519350771200.mp4',
    '1519350771569.mp4',
    '1519350771914.mp4',
    '1519350772806.mp4',
    '1519350773946.mp4',
    '1519350774329.mp4',
    '1519350774710.mp4',
    '1519350775057.mp4',
    '1519350775426.mp4',
    '1519350775803.mp4',
    '1519350776643.mp4',
    '1519350777054.mp4',
    '1519350777420.mp4',
    '1519350778139.mp4',
    '1519350778580.mp4',
    '1519350779069.mp4',
    '1519350779516.mp4',
    '1519350780307.mp4',
    '1519350780654.mp4',
    '1519350780998.mp4',
    '1519350781368.mp4',
    '1519350781710.mp4',
    '1519350782055.mp4',
    '1519350782402.mp4',
    '1519350782762.mp4',
    '1521283416839.mp4',
    '1521283466372.mp4',
    '1521283467703.mp4',
    '1521283468458.mp4',
    '1521283469173.mp4',
    '1521283470013.mp4',
    '1521283470822.mp4',
    '1521283471642.mp4',
    '1521283472365.mp4',
    '1521283473255.mp4',
    '1521283474814.mp4',
    '1521372151713.mp4',
    '1521372154058.mp4',
    '1521372154939.mp4',
    '1521372156691.mp4',
    '1521372157680.mp4',
    '1521372158395.mp4',
    '1521372159176.mp4',
    '1521372160105.mp4',
    '1521372161039.mp4',
    '1521466468091.mp4',
    '1521466468765.mp4',
    '1521466469801.mp4',
    '1521466470847.mp4',
    '1521466471773.mp4',
    '1521466472634.mp4',
    '1521466473419.mp4',
    '1521889521812.mp4',
    '1521956568935.mp4',
    '1521956569816.mp4',
    '1521956571273.mp4',
    '1521956571991.mp4',
    '1521956573361.mp4',
    '1521956574844.mp4',
    '1521956576312.mp4',
    '1521956577477.mp4',
    '1521956578666.mp4',
    '1521956579937.mp4',
    '1521956581013.mp4',
    '1521956582101.mp4',
    '1521956583217.mp4',
    '1521956584437.mp4',
    '1521956585705.mp4',
    '1522419865882.mp4',
    '1522419866804.mp4',
    '1522419868440.mp4',
    '1522419870490.mp4',
    '1522419871820.mp4',
    '1522419874608.mp4',
    '1522419876030.mp4',
    '1522419877947.mp4',
    '1522419879698.mp4',
    '1522419884622.mp4',
    '1522419886399.mp4',
    '1522419888796.mp4',
    '1522419890496.mp4',
    '1522419892233.mp4',
    '1522419893958.mp4',
    '1522419895741.mp4'
  ]

  new Vue({
    el: '#app',
    data: {
      videos,
      previews,
      openDoor: false,
      bShowPreviews: false,
      bShowVideo: false,
      current: '',
      open: false,
      sections: [
        { name: '哔哩哔哩', value: 'bilibili' },
        { name: '剪辑', value: 'clips' },
        { name: 'JOI', value: 'jois' },
        { name: 'HandJobs', value: 'handjobs' },
        { name: 'JAVHD', value: 'JAVHD' },
        { name: 'ASMR', value: 'asmrs' },
        { name: '花椒', value: 'huajiao' },
        { name: '3D', value: 'threed' },
        { name: '抖音', value: 'douyin' }
      ]
    },
    watch: {
      open(val) {
        if (val) {
          document.addEventListener('keydown', this.closeByEsc)
        } else {
          document.removeEventListener('keydown', this.closeByEsc)
        }
      }
    },
    methods: {
      invalidate(ev) {
        if (ev.target.value === 'vue') {
          sessionStorage.door = 'vue'
          this.openDoor = true
        }
      },
      play(ev, file) {
        const video = ev.target
        if (video.src === '') {
          video.src = `/video/douyin/${file}`
          video.play()
        } else {
          if (video.paused) {
            video.play()
          } else {
            video.pause()
          }
        }
      },
      view(v, type) {
        this.current = `/video/${type}/${v}`
        this.bShowVideo = true
        setTimeout(() => this.$refs.video.play(), 400)
        this.open = true
      },
      close() {
        this.bShowVideo = false
        this.$refs.video.pause()
        this.open = false
      },
      closeByEsc(ev) {
        if (ev.keyCode === 27) {
          this.close()
        }
      },
      scrollTo(section) {
        this.$refs[section][0].scrollIntoView()
      }
    },
    mounted() {
      this.openDoor = sessionStorage.door === 'vue'
    }
  })
</script>
</body>
</html>
